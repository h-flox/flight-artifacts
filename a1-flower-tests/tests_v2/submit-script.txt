#!/bin/bash
#SBATCH --job-name="flower-test"
#SBATCH --output="flower-test-out.%j.%N.out"
#SBATCH --partition=compute
#SBATCH --nodes=2
#SBATCH --ntasks-per-node=1
#SBATCH --mem=240G 
#SBATCH --account=chi150
#SBATCH --export=ALL
#SBATCH -t 00:05:00

export NODES=$SLURM_JOB_NUM_NODES
ipad=$(hostname -I | awk '{print $3}')
echo $ipad
module load anaconda3/2021.05
conda activate flower_scale

python ~/newnew/server.py --clients 1 --ip $ipad & 

srun --ntasks $((NODES - 1)) -l --exclude=$SLURMD_NODENAME ~/newnew/client-run.sh 1 0 $ipad

wait
